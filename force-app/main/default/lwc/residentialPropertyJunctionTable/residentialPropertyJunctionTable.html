<template>
    
    <div class="slds-box slds-theme--default" style="padding-bottom: 52px;">
        <div class="slds-text-heading_medium" style="font-weight: bold;">Deal Units</div>
        <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped">
            <thead>
                <tr class="slds-line-height_reset">
                    <th>Unit Name</th>
                    <th>Unit No</th>
                    <th>Location And Visibility</th>
                    <th>Land Area</th>
                    <th>Land Sellable Area / Sqm</th>
                    <th>Land Sellable Amount</th>
                    <th>Villa Area</th>
                    <th>Villa Sellable Area / Sqm</th>
                    <th>Villa Sellable Amount</th>
                    <th>Pre Launch Price</th>
                    <th>Asking Price</th>
                    <th>Total Selling Price</th>
                    <th>
                        <lightning-button variant="brand" title="Update" onclick={updatePage} icon-name="utility:refresh" class="slds-m-left_x-small"></lightning-button>
                    </th>
                </tr>
            </thead>
            <tbody>
                    <template for:each={dealRecords} for:item="dealrecord" for:index="index">
                        <tr class="slds-hint-parent" id={index} data-id={dealrecord.Id} key={dealrecord.Id} data-index={index}>
                            <td data-label="Unit Name">
                                {dealrecord.Name}
                            </td>
                            <td data-label="Unit No">
                                {dealrecord.Unit_No__c}
                            </td>
                            <td data-label="Location And Visibility">
                                {dealrecord.LocationAndVisibility__c}
                            </td>
                            <td data-label="Land Area">
                                <lightning-formatted-number
                                value={dealrecord.LandArea__c}
                                format-style="decimal">
                            </lightning-formatted-number>
                            </td>
                            <td data-label="Land Sellable Area / Sqm">
                                <lightning-formatted-number
                                value={dealrecord.LandSellableAreaSqm__c}
                                format-style="currency">
                            </lightning-formatted-number>
                            </td>
                            <td data-label="Land Sellable Amount">
                                <lightning-formatted-number
                                value={dealrecord.LandSellableAmount__c}
                                format-style="currency">
                            </lightning-formatted-number>
                            </td>
                            <td data-label="Villa Area">
                                <lightning-formatted-number
                                value={dealrecord.VillaArea__c}
                                format-style="decimal">
                            </lightning-formatted-number>
                            </td>
                            <td data-label="Villa Sellable Area / Sqm">
                                <lightning-formatted-number
                                value={dealrecord.VillaSellableAreaSqm__c}
                                format-style="currency">
                            </lightning-formatted-number>
                            </td>
                            <td data-label="Villa Sellable Amount">
                                <lightning-formatted-number
                                value={dealrecord.VillaSellableAmount__c}
                                format-style="currency">
                            </lightning-formatted-number>
                            </td>
                            <td data-label="Pre Launch Price">
                                <lightning-formatted-number
                                value={dealrecord.PreLaunchPrice__c}
                                format-style="currency">
                            </lightning-formatted-number>
                            </td>
                            <td data-label="Asking Price">
                                <lightning-formatted-number
                                value={dealrecord.Asking_Price__c}
                                format-style="currency">
                            </lightning-formatted-number>
                            </td>
                            <td data-label="Total Selling Price">
                                <lightning-formatted-number
                                value={dealrecord.Total_Selling_Price_SAR__c}
                                format-style="currency">
                            </lightning-formatted-number>
                            </td>
                            <td>
                                <lightning-button variant="brand" label="Edit" title="Edit" onclick={openModal} class="slds-m-left_x-small" data-id={dealrecord.Id}></lightning-button>
                                <lightning-button variant="brand" label="Delete" title="Delete" onclick={deleteRecordModal} class="slds-m-left_x-small" data-id={dealrecord.Id}></lightning-button>
                            </td>
                        </tr>                   
                    </template>
            </tbody>
        </table>
        <div class="slds-grid">
            
            <div class="slds-col slds-size_8-of-8">
                <div style="width:100%; height:25px;"></div>
                <div style="width:100%; height:7px; border-top:5px solid black;"></div>
                <div class="slds-text-heading_medium" style="font-weight: bold;">Units</div>
                <!--fix alignment of the comboboxes and input field using sdls -->
                
                <div class="slds-grid slds-gutters ">

                    <div class="slds-col slds-size_1-of-8">
                        <lightning-combobox
                                label="Location And Visibility"
                                options={optionsLocationAndVisibility}
                                value={valueLocationAndVisibilityPicklist}
                                onchange={handleChangeLocationAndVisibility}></lightning-combobox>
                    </div>
                    <div class="slds-col slds-size_1-of-8">
                        <lightning-combobox
                                label="Unit Type"
                                options={optionsUnitType}
                                value={valueUnitType}
                                onchange={handleChangeUnitType}></lightning-combobox>
                    </div>
                    <div class="slds-col slds-size_1-of-8">
                        <!--field to type the unit no only number-->
                        <lightning-input 
                            type="number" 
                            value={valueUnitNo} 
                            onchange={handleChangeUnitNo} 
                            label="Unit No"
                            placeholder="Enter Unit No">

                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-8">
                        <lightning-combobox
                                label="Status"
                                options={optionsStatusPicklist}
                                value={valueStatusPicklist}
                                onchange={handleChangeStatus}>
                        </lightning-combobox>
                    </div>
                    
                    <div class="slds-col slds-size_1-of-8">
                        <div class="slds-form-element" style="display: flex; align-items: flex-end; height: 95%; ">
                            <lightning-button 
                                variant="brand" 
                                label="Add Units" 
                                title="Add Units" 
                                onclick={getAllId} 
                                data-id="reprocess">
                            </lightning-button>
                            </div>
                    </div>
                </div>
            </div>
            <div class="slds-col slds-size_8-of-8">
                <!--<template if:true={showMessage}>
                    <p class="community-message">{messageText}</p>
                </template>-->
                <!--<lightning-button variant="brand" label="Reset filters" title="Reset filters" onclick={resetData} class="slds-m-left_x-small" data-id="reprocess1"></lightning-button>-->
            </div>
            
        </div> 
        <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped">
            <thead>
                <tr class="slds-line-height_reset">
                    <th>
                        <lightning-input class="slds-p-left_x-large" type="checkbox" onchange={handleChange} ></lightning-input>
                    </th>
                        <th>Location And Visibility</th>
                        <th>Unit No</th>
                        <th>Unit Type</th>
                        <th>Land Area</th>
                        <th>Land Sellable Area / Sqm</th>
                        <th>Land Sellable Amount</th>
                        <th>Villa Area</th>
                        <th>Villa Sellable Area / Sqm</th>
                        <th>Villa Sellable Amount</th>
                        <th>Pre Launch Price</th>
                        <th>Asking Price</th>
                        <th>Status</th>
                </tr>
            </thead>
            <tbody>
                    <template for:each={records} for:item="record" for:index="index">
                        <tr class="slds-hint-parent" id={index} data-id={record.Id} key={record.Id} data-index={index}>
                            <td >
                                <lightning-input class="slds-p-left_x-large" type="checkbox" checked={record.selected} onchange={oneChange} title="checkboxTitle" data-id={record.Id} ></lightning-input>
                            </td>
                             <!-- add all fields from Building__c object from residential property record type -->
                             <td>{record.LocationAndVisibility__c}</td>
                             <td>{record.Unit_No__c}</td>
                             <td>{record.Unit_Type__c}</td>
                             <td><lightning-formatted-number
                                value={record.LandArea__c}
                                format-style="decimal">
                            </lightning-formatted-number>
                            </td>
                             <td><lightning-formatted-number
                                value={record.LandSellableAreaSqm__c}
                                format-style="currency">
                            </lightning-formatted-number></td>
                             <td><lightning-formatted-number
                                value={record.LandSellableAmount__c}
                                format-style="currency">
                            </lightning-formatted-number></td>
                             <td><lightning-formatted-number
                                value={record.VillaArea__c}
                                format-style="decimal">
                            </lightning-formatted-number>
                            </td>
                             <td><lightning-formatted-number
                                value={record.VillaSellableAreaSqm__c}
                                format-style="currency">
                            </lightning-formatted-number></td>
                             <td><lightning-formatted-number
                                value={record.VillaSellableAmount__c}
                                format-style="currency">
                            </lightning-formatted-number></td>
                             <td><lightning-formatted-number
                                value={record.PreLaunchPrice__c}
                                format-style="currency">
                            </lightning-formatted-number></td>
                             <td><lightning-formatted-number
                                value={record.Asking_Price__c}
                                format-style="currency">
                            </lightning-formatted-number></td>
                              <td>{record.Status__c}</td>
                        </tr>                   
                    </template>
            </tbody>
        </table>
        <template if:true={isModalOpen}>
            <!-- Modal/Popup Box LWC starts here -->
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <!-- Modal/Popup Box LWC header here -->
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                            <lightning-icon icon-name="utility:close"
                                alternative-text="close"
                                variant="inverse"
                                size="small" ></lightning-icon>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Request Update for Unit</h2>
                    </header>
                    <!-- Modal/Popup Box LWC body starts here -->
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <lightning-record-edit-form object-api-name="Deal_Building__c"
                            record-id={recordEditId}
                            onsuccess={handleSuccess}
                            onerror={handleErrorFormSubmit}>

                            <lightning-layout multiple-rows>
                                <!--not editable fields-->           
                                <lightning-layout-item size="6">
                                    <lightning-output-field field-name="LocationAndVisibility__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="Unit_No__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="Unit_Type__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="LandArea__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="LandSellableAreaSqm__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="LandSellableAmount__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="VillaArea__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="VillaSellableAreaSqm__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="VillaSellableAmount__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="PreLaunchPrice__c"></lightning-output-field>
                                </lightning-layout-item>
                                
                                <lightning-layout-item size="6">
                                    <lightning-output-field  field-name="Asking_Price__c"></lightning-output-field>
                                </lightning-layout-item>
                                <lightning-layout-item size="12">
                                    <lightning-input-field field-name="Total_Selling_Price_SAR__c"></lightning-input-field>
                                    </lightning-layout-item>
                                <lightning-layout-item size="12">
                                    <lightning-input-field field-name="Price_Notes__c"></lightning-input-field>
                                    </lightning-layout-item>
                                <lightning-layout-item size="12">

                                <div class="slds-m-top_large slds-grid slds-grid_align-center">
                                    <lightning-button variant="neutral"
                                                    label="Cancel"
                                                    title="Cancel"
                                                    type="text"
                                                    onclick={handleCancel}
                                                    class="slds-m-right_small"></lightning-button>
                                    <lightning-button variant="brand"
                                                    label="Submit"
                                                    title="Submit"
                                                    type="submit"
                                                    onclick={submitDetails}></lightning-button>
                                </div>
                                </lightning-layout-item>
                            </lightning-layout>
                        </lightning-record-edit-form>	
                    </div>
                    <!-- Modal/Popup Box LWC footer starts here -->
                    <footer class="slds-modal__footer">
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
        <!--DELETE SECTION START-->
        <template if:true={isModalOpen2}>
            <!-- Modal/Popup Box LWC starts here -->
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-2" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <!-- Modal/Popup Box LWC header here -->
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal2}>
                        <lightning-icon icon-name="utility:close"
                            alternative-text="close"
                            variant="inverse"
                            size="small" ></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 id="modal-heading-02" class="slds-text-heading_medium slds-hyphenate">Deleted Deal Building</h2>
                </header>
                <!-- Modal/Popup Box LWC body starts here -->
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-2">
                    <p><b>Record will be deleted. Are you sure?
                    </b></p>
                </div>
                <!-- Modal/Popup Box LWC footer starts here -->
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={closeModal2} title="Cancel">Cancel</button>
                    <button class="slds-button slds-button_brand" onclick={submitDetails2} title="OK">OK</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
        <!--DELETE SECTION END-->
    </div>
</template>